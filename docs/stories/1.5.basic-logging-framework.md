# Story 1.5: Basic Logging Framework and Console Output

## Status
New

## Story
**As a** developer,
**I want** structured logging with configurable verbosity levels,
**so that** I can debug issues during development and monitor the system in production.

## Acceptance Criteria

1. Python logging configured in core/logging_config.py with setup_logging(config) function
2. Logging level configurable via YAML: DEBUG, INFO, WARNING, ERROR
3. Console handler outputs to stdout with formatted messages: "[TIMESTAMP] [LEVEL] [MODULE] Message"
4. Timestamp format: ISO 8601 with timezone (2025-11-08T14:32:15-08:00)
5. Module name included in log output for easy debugging (e.g., [rtsp], [motion], [pipeline])
6. Structured logging metadata available for future JSON output (not yet implemented, but architecture supports it)
7. Key events logged at INFO level: RTSP connected, motion detected, frame processed, metrics summary
8. Errors logged at ERROR level with full exception stack traces
9. DEBUG level logs frame-by-frame processing details (frame number, motion confidence, sampling decision)
10. Logging performance overhead measured: <2% CPU impact at INFO level, <5% at DEBUG level (verified via profiling)
11. Unit tests verify correct log level filtering (DEBUG messages don't appear when level=INFO)
12. Manual test: Run system with different log levels, verify appropriate messages appear/disappear

## Tasks / Subtasks

- [ ] **Task 1: Create logging configuration module structure** (AC: 1, 2)
  - [ ] Create `core/logging_config.py` module file
  - [ ] Define `setup_logging(config: SystemConfig) -> None` function
  - [ ] Parse log_level from config (DEBUG, INFO, WARNING, ERROR)
  - [ ] Configure Python logging with appropriate level
  - [ ] Add proper type hints and Google-style function docstring

- [ ] **Task 2: Implement console handler with custom formatting** (AC: 3, 4, 5)
  - [ ] Create custom formatter class for console output
  - [ ] Implement timestamp formatting: ISO 8601 with timezone
  - [ ] Add module name extraction from logger name
  - [ ] Format: "[TIMESTAMP] [LEVEL] [MODULE] Message"
  - [ ] Add console handler to root logger with custom formatter

- [ ] **Task 3: Add structured logging support** (AC: 6)
  - [ ] Design logging metadata structure for future JSON output
  - [ ] Add extra fields support in log records
  - [ ] Ensure backward compatibility with console formatting
  - [ ] Document metadata structure for future implementation

- [ ] **Task 4: Integrate logging into existing components** (AC: 7, 8, 9)
  - [ ] Add logging to RTSPCameraClient: connection events, frame capture
  - [ ] Add logging to MotionDetector: motion detection events with confidence
  - [ ] Add logging to ProcessingPipeline: frame processing, sampling decisions, metrics
  - [ ] Add error logging with stack traces for exceptions
  - [ ] Use appropriate log levels: INFO for key events, DEBUG for details, ERROR for exceptions

- [ ] **Task 5: Performance profiling and optimization** (AC: 10)
  - [ ] Create performance test script to measure logging overhead
  - [ ] Profile CPU impact at different log levels
  - [ ] Optimize logging calls to meet performance requirements (<2% INFO, <5% DEBUG)
  - [ ] Document performance characteristics

- [ ] **Task 6: Unit tests for logging functionality** (AC: 11)
  - [ ] Create `tests/unit/test_logging_config.py`
  - [ ] Test log level filtering (DEBUG vs INFO)
  - [ ] Test custom formatter output format
  - [ ] Test module name extraction
  - [ ] Mock logging output to verify correct messages

- [ ] **Task 7: Manual testing and validation** (AC: 12)
  - [ ] Test different log levels with sample execution
  - [ ] Verify DEBUG messages appear/disappear appropriately
  - [ ] Test error logging with stack traces
  - [ ] Document manual test procedures

## Dev Notes

### Architecture Considerations
- **Logging Levels**: Standard Python logging levels (DEBUG=10, INFO=20, WARNING=30, ERROR=40)
- **Module Naming**: Use short, consistent module names in brackets: [rtsp], [motion], [pipeline], [main]
- **Performance**: Logging should be lightweight - avoid expensive operations in log calls
- **Future Extensibility**: Design for JSON structured logging (Phase 2) with metadata fields
- **Configuration**: log_level in SystemConfig, validated via Pydantic enum

### Integration Points
- **SystemConfig**: Add log_level field with validation
- **Main Entry Point**: Call setup_logging() early in initialization
- **All Components**: Add appropriate logging calls throughout codebase
- **Error Handling**: Ensure exceptions are logged with full context

### Testing Strategy
- **Unit Tests**: Focus on configuration and formatter logic
- **Integration Tests**: Verify logging appears in system output
- **Performance Tests**: Measure overhead with profiling tools

### Dependencies
- **Python Standard Library**: logging module
- **Existing Code**: SystemConfig for configuration
- **Future Stories**: JSON logging (Phase 2), log rotation (Phase 3)

## QA Results

*QA assessment will be performed after implementation is complete.*